#!/bin/sh
url="https://a.4cdn.org/$1/$2.json"

thread=$(curl -s "$url" | jq -r '
  .posts[] as $post |
  "No. \u001b[32m\($post.no)\u001b[0m \u001b[90m\($post.now)\u001b[0m",
  "\u001b[32m\($post.name)\u001b[0m",
  (
    if $post.sub then
      "\u001b[31m\($post.sub)\u001b[0m\n"
    else empty end
  ),
  ($post.com | gsub("<br>"; "\n") | gsub("&gt;"; ">") | gsub("&quot;"; "\"") | gsub("<a[^>]*>"; "") | gsub("</a>"; "") | gsub("<span[^>]*>"; "\u001b[32m") | gsub("</span>"; "\u001b[0m") | @text)')

echo "$thread"
